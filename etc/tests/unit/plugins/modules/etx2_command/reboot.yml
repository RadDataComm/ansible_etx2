---
- name: "Local play"
  hosts: all
  gather_facts: no

  vars:
    ansible_user: su
    ansible_password: 1234
    ansible_connection: ansible.netcommon.network_cli
    ansible_network_os: raddatacomm.etx2.rad

  tasks:

    - name: "Execute Reboot"
      raddatacomm.etx2.etx2_command:
        commands: [ 'admin reboot' ]
      register: reboot_response

    - name: "Reboot output"
      ansible.builtin.debug:
        msg: "{{ reboot_response.stdout }}"

    - name: Wait for network device to come back up
      ansible.builtin.wait_for_connection:
        delay: 15 # Number of seconds to wait before starting to poll.
        connect_timeout: 20 # Maximum number of seconds to wait for a connection to happen before closing and retrying.
        sleep: 3 # Number of seconds to sleep between checks.
        timeout: 300 # Maximum number of seconds to wait for.

    - name: Wait for the device to come back online
      ansible.builtin.wait_for:
        host: "{{ inventory_hostname }}"
        delay: 5 # Number of seconds to wait before starting to poll.
        sleep: 1 # Number of seconds to sleep between checks.
        timeout: 6 # Maximum number of seconds to wait for.
      delegate_to: localhost
